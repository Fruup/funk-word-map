name: funk-word-map
services:
  db:
    build:
      context: .
      dockerfile: ./docker/db/Dockerfile
    ports:
      - ${PORT_DB}:8080
    volumes:
      - /volumes/funk-word-map/staging/pb_data:/pb/pb_data
    # healthcheck:
    #   test: ["CMD", "curl", "-sSf", "http://localhost:8080"]
    #   interval: 1m
    #   timeout: 5s
    #   retries: 5
    #   start_period: 5s

  web:
    build:
      context: .
      dockerfile: ./docker/web/Dockerfile
      target: production
    ports:
      - ${PORT_WEB}:${PORT_WEB}
    environment:
      ORIGIN: ${ORIGIN}
      PORT: ${PORT_WEB}
      DB_URL: ${DB_URL}
      DB_ADMIN_USER: ${DB_ADMIN_USER}
      DB_ADMIN_PASSWORD: ${DB_ADMIN_PASSWORD}
      ADMIN_AUTH: ${ADMIN_AUTH}

      PUBLIC_IS_STAGING: ${PUBLIC_IS_STAGING}
      PUBLIC_SOURCE_COMMIT: ${SOURCE_COMMIT}
      PUBLIC_ORIGIN: ${ORIGIN}

      PUBLIC_SENTRY_DSN_KEY: ${PUBLIC_SENTRY_DSN_KEY}
      PUBLIC_SENTRY_DSN_DOMAIN: ${PUBLIC_SENTRY_DSN_DOMAIN}
      PUBLIC_SENTRY_DSN_PROJECT_ID: ${PUBLIC_SENTRY_DSN_PROJECT_ID}
